<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">
<script th:src="@{/jQuery/jquery-3.7.0.js}"></script>
<script>
$(document).ready(function(){
	memTypeChk();
	subBtnVisible();
});

const target = document.getElementById('subBtn');
let check = true;

function idChk(){
	let id = $('#memberId').val();
	let regId = /^[a-z]+[a-z0-9]{5,19}$/g;
	
	$.ajax({
        url:'checkId', 
        type:'post', 
        data:{memberId:id},
        success:function(cnt){ 
            if(cnt != 0){  
                alert('중복된 아이디입니다.');
                id == '';
            } else { 
            	$('#errMsg1').html('사용 가능한 아이디입니다.');
            }
        },
        error:function(){
            alert("에러입니다");
        }
    });
	
	if(!regId.test(id)){
		$('#errMsg1').html('아이디는 6-12자 영문/숫자를 포함해야 합니다.');
		check = false;
	}
	else {
		$('#errMsg1').html('');
		check = true
	}
}

function pwChk(){
	let pw1 = $('#memberPw').val();
	let pw2 = $('#memberPw2').val();
	let regPw =  /^(?=.*[a-zA-Z])(?=.*[!@#$%^*+=-])(?=.*[0-9]).{8,15}$/;
	
	if(!regPw.test(pw1)){
		$('#errMsg2').html('비밀번호는 8-15자리 문자/숫자/특수문자를 포함해야 합니다.');
		check = false;
	}
	else if(pw1 !== pw2){
		$('#errMsg3').html('비밀번호가 일치하지 않습니다.');
		check = false;
	}
	else{
		$('#errMsg2').html('');
		$('#errMsg3').html('');
		check = true
	}
}

function nameChk(){
	let name = $('#memberName').val();
	
	if(name < 1 || name > 9){
		$('#errMsg4').html('이름은 2-10자로 입력해주세요.');
		check = false;
	}
	else{
		$('#errMsg4').html('');
		check = true
	}
}

function emailChk(){
	let email = $('#email').val();
	let regEmail = /^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*.[a-zA-Z]{2,3}$/i;
	
	$.ajax({
        url:'checkEmail', 
        type:'post', 
        data:{email:email},
        success:function(cnt){ 
            if(cnt != 0){  
                alert('이미 사용 중인 이메일 주소입니다.');
                email  == '';
            } else { 
            	$('#errMsg5').html('사용 가능한 이메일 주소입니다.');
            }
        },
        error:function(){
            alert("에러입니다");
        }
    });
	
	if(!regPw.test(email)){
        $('#errMsg5').html('이메일은 xxx@xxx.xxx 형식으로 입력해야 합니다.');
        check = false;
	}
	else{
		$('#errMsg5').html('');
		check = true
	}
}

function phoneChk(){
	let phone = $('#phone').val();
	let regPhone = /^[0-9]{2,3}-[0-9]{3,4}-[0-9]{4}/;
	
	if(!regPhone.test(phone)){
        $('#errMsg6').html('전화번호 형식이 올바르지 않습니다.');
        check = false;
    }
	else{
		$('#errMsg6').html('');
		check = true
	}
} 

function memTypeChk(){
	let regMemberType = $('input:radio[name=memberType]').is(":checked");
	
	if(regMemberType != true){
		$('#errMsg7').html('회원 구분을 선택해주십시오.');
		check = false;
	}
	else{
		$('#errMsg7').html('');
		check = true
	}
}

function subBtnVisible(){
	if(check == true) target.disabled = false;
	else target.disabled = true;
}

</script>
<link rel="stylesheet" th:href="@{/CSS/}">
<title>Join</title>

</head>
<body>
	<main>
		<h1 class="title">회원 가입</h1>
		<form id="joinForm" th:action="@{/member/join}" method="post">
				ID
				<input type="text" name="memberId" id="memberId"
				placeholder="ID(6-12자리 이내, 영문 사용 가능)" required="required" onkeyup="idChk()">
				<p id="errMsg1"></p>
				<br>
				비밀번호
				<input type="password" name="memberPw" id="memberPw"
				placeholder="비밀번호(8-15자리 문자/숫자/기호 사용 가능)" required="required" onkeyup="pwChk()">
				<p id="errMsg2"></p>
				<br>
				비밀번호 확인
				<input type="password" name="memberPw" id="memberPw"
				placeholder="비밀번호 확인" required="required" onkeyup="pwChk()">
				<p id="errMsg3"></p>
				<br>
				이름
				<input type="text" name="memberName" id="memberName" 
				placeholder="이름(필수)" required="required" onkeyup="nameChk()">				
				<p id="errMsg4"></p>
				<br>
				이메일
				<input type="text" name="email" id="email"
				placeholder="이메일(필수, 아이디 확인에 이용됩니다.)" required="required" onkeyup="emailChk()">
				<input type="button" value="이메일 인증하기">
				<p id="errMsg5"></p>
				<br>
				핸드폰번호
				<input type="text" name="phone" id="phone" placeholder="전화번호(-빼고 숫자만 입력)" 
				required="required" onkeyup="phoneChk()">
				<p id="errMsg6"></p>
				<br>
				생일
				<input type="date" name="birthday" id="birthday" required="required">
				<br>
				회원구분
    			<input type="radio" name="memberType" id="ROLE_PERSONAL" value="ROLE_PERSONAL">개인회원
    			<input type="radio" name="memberType" id="ROLE_CORPORATE" value="ROLE_CORPORATE">기업회원
    			<br><p id="errMsg7"></p>
				<br>
				성별
              	<select name="gender">
                	<option value="N" selected>선택안함</option>
                	<option value="M">남자</option>
                	<option value="F">여자</option>
                </select><br>
                <p id="errMsg7"></p>
                <br>
				<div class="bottom-container">
					<input type="submit" id="subBtn" class="bottom" value="가입하기">
					<input type="reset" class="bottom" value="다시 쓰기">
				</div>
		</form>
	</main>
</body>
</html>