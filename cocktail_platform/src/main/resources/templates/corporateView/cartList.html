<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">
<title>장바구니</title>
<title>카트 메뉴</title>
<link rel="stylesheet" href="../../static/CSS/corporate/reset.css">
<link rel="stylesheet" href="../../static/CSS/corporate/cartList.css">
<!-- vs code -->
<link rel="stylesheet" th:href="@{/CSS/corporate/reset.css}">
<link rel="stylesheet" th:href="@{/CSS/corporate/cartList.css}">
<!-- thymeleaf -->

<script th:src="@{/jQuery/jquery-3.7.0.js}"></script>
<script>
$(document).ready(function(){
	//카트에 담은 목록 가져오기
	function cart(){
		$.ajax({
			url: "cart",
			type: "get",
			dataType: "json",
			success: function(list){
				if(list == ''){
					return;
				}
				getList(list);
			},
			error: function(err){
				alert(err);
			}
		});
	}
	
	//메뉴 리스트 출력
	function getList(list){
		let str = '<table>';
		$(list).each(function(i,item){
			let menuNum = item.menuNum;
			let orderCount = parseInt($('#orderCount_' + menuNum).text()) || 1;
			let price = item.price;
			let price2 = orderCount * price;
			
			str += '<tr>';
			str += '<td colspan="3">' + item.menuName + '</td></tr>';
			str += '<td><a href="javascript:deleteCart(' + menuNum + ')"><button>삭제</button></a></td></tr>';
			str += '<tr><td><a href="javascript:count(\'plus\',' + menuNum + ')|">+</a></td>';
			str += '<td><span id="orderCount_' + menuNum + '">' + orderCount + '</span>개</td>';
			str += '<td><a href="javascript:count(\'minus\',' + menuNum + ')">-</a></td>';
			str += '<td><span id="price_' + menuNum + '">' + item.price + '</span>원</td></tr>';
			str += '</tr>';
		});
		str += '</table>';
		$('#cartList').html(str);
	}
	
	/**카트 메뉴 삭제*/
	function deleteCart(menuNum){
		let result = confirm('선택한 메뉴를 삭제하시겠습니까?');
		if(result == true){
			location.href="deleteCart?menuNum="+menuNum;
		}
	}
	
	/**주문 수량 증감*/
	function count(type, menuNum){
		let orderCount = parseInt($('#orderCount_' + menuNum).text());
		
		//더하기, 빼기
		if(type === 'plus' && orderCount < 11) {
			orderCount = orderCount + 1;  
	  	}else if(type === 'minus' && orderCount > 1) {
	  		orderCount = orderCount - 1;
	  	}else {
			alert('주문 수량을 확인해주세요.');
			return false;
		}
		
		// 결과 출력
	    $('#orderCount_' + menuNum).text(orderCount);
	}
	
	/**창 닫기*/
	function closeCart(){
		window.close();
	}
	
});

</script>
</head>

<body>
	<div class="container">
	  <div class="header">
		<h1>장바구니</h1>
	  </div>
	  <!-- 카트에 담은 메뉴 출력 -->
	  <div id="cartList">
		<div class="cart-item">
		  <h2>상품 이름</h2>
		  <div class="cart-controls">
			<button>+</button>
			<span>1</span> <!-- 주문 수량 -->
			<button>-</button>
			<span class="price">10,000원</span> <!-- 가격 -->
			<button class="delete-button">Del</button>
		  </div>
		</div>
	  </div>
	  <p class="cart-total">합계: <span id="totalPrice">10,000원</span></p>
	  <a href="javascript:closeCart()"><button class="orderBT">닫기</button></a>
	  <a th:href="@{/corporate/order/orderMenu}" ><button class="orderBT">주문하기</button></a>
	</div>
  </body>
</html>