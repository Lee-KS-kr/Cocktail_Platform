<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Join</title>
    <link rel="stylesheet" th:href="@{/CSS/login.css}">
    <script th:src="@{/jQuery/jquery-3.7.0.js}"></script>
   <script>
$(document).ready(function(){
    
});

function validChk(){
	const target = document.getElementById('subBtn');
	
	let id = $('#memberId').val();
	let pw1 = $('#memberPw').val();
	let pw2 = $('#memberPw2').val();
	let name = $('#memberName').val();
	let email = $('#email').val();
	let phone = $('#phone').val();
	let regId =  /^[a-z]+[a-z0-9]{5,19}$/g;
	let regPw =  /^(?=.*[a-zA-Z])(?=.*[!@#$%^*+=-])(?=.*[0-9]).{8,15}$/;
	let regEmail = /^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*.[a-zA-Z]{2,3}$/i;
	let regPhone = /^[0-9]{2,3}-[0-9]{3,4}-[0-9]{4}/;
	
	$.ajax({
        url:'checkId', 
        type:'post', 
        data:{memberId:id},
        success:function(cnt){ 
            if(cnt != 0){  
                alert('중복된 아이디입니다.');
                id == '';
            } else { 
            	$('#errMsg1').html('사용 가능한 아이디입니다.');
            }
        },
        error:function(){
            alert("에러입니다");
        }
    });
	
	$.ajax({
        url:'checkEmail', 
        type:'post', 
        data:{email:email},
        success:function(cnt){ 
            if(cnt != 0){  
                alert('이미 사용 중인 이메일 주소입니다.');
                email  == '';
            } else { 
            	$('#errMsg5').html('사용 가능한 이메일 주소입니다.');
            }
        },
        error:function(){
            alert("에러입니다");
        }
    });
	
	if(!regId.test(id)){
		$('#errMsg1').html('아이디는 6-12자 영문/숫자를 포함해야 합니다.');
		target.disabled = true;
	}
	else if(!regPw.test(pw1)){
		$('#errMsg1').html('');
		$('#errMsg2').html('비밀번호는 8-15자리 문자/숫자/특수문자를 포함해야 합니다.');
		target.disabled = true;
	}
	else if(pw1 !== pw2){
		$('#errMsg2').html('');
		$('#errMsg3').html('비밀번호가 일치하지 않습니다.');
		target.disabled = true;
	}
	else if(name < 1 || name > 9){
		$('#errMsg3').html('');
		$('#errMsg4').html('이름은 2-10자로 입력해주세요.');
		target.disabled = true;
	}else if(!regPw.test(email)){
		$('#errMsg4').html('');
        $('#errMsg5').html('이메일은 xxx@xxx.xxx 형식으로 입력해야 합니다.');
        target.disabled = true;
	}else if(!regPhone.test(phone)){
		$('#errMsg5').html('');
        $('#errMsg6').html('전화번호 형식이 올바르지 않습니다.');
        target.disabled = true;
    }
	else{
		$('#errMsg6').html('');
		target.disabled = false;
	}
}

</script>
<link rel="stylesheet" th:href="@{/CSS/}">
</head>
<body>
	<main>
		<h1 class="title">회원 가입</h1>
		<form id="joinForm" th:action="@{/member/join}" method="post">
				ID
				<input type="text" name="memberId" id="memberId" placeholder="ID(6-12자리 이내, 영문/숫자 사용 가능)"
				size="25" required="required" onkeyup="validChk()">
				<p id="errMsg1"></p>
				<br>
				비밀번호
				<input type="password" name="memberPw" id="memberPw" placeholder="비밀번호(8-15자리 문자/숫자/기호 사용 가능)" 
				size="25" required="required" onkeyup="validChk()">
				<p id="errMsg2"></p>
				<br>
				비밀번호 재입력
				<input type="password" id="memberPw2" placeholder="비밀번호 다시 입력"
				size="25" required="required" onkeyup="validChk()">
				<p id="errMsg3"></p>
				<br>
				이름
				<input type="text" name="memberName" id="memberName" placeholder="이름(필수)"
				size="25" required="required" onkeyup="validChk()">				
				<p id="errMsg4"></p>
				<br>
				이메일
				<input type="text" name="email" id="email" placeholder="이메일(필수, 아이디 확인에 이용됩니다.)" 
				size="25" required="required" onkeyup="validChk()">
				<p id="errMsg5"></p>
				<br>
				핸드폰번호
				<input type="text" name="phone" id="phone" placeholder="전화번호(-빼고 숫자만 입력)" 
				size="25" required="required" onkeyup="validChk()">
				<p id="errMsg6"></p>
				<br>
				생일
				<input type="date" name="birthday" id="birthday" required="required">
				<p id="errMsg6"></p>
				<br>
				회원구분
				<input type="radio" name="memberType" id="personal" value="personal">개인회원
				<input type="radio" name="memberType" id="corporate" value="corporate">기업회원
				<p id="errMsg7"></p>
				<br>
				성별
              	<select name="gender">
                	<option value="N" selected>선택안함</option>
                	<option value="M">남자</option>
                	<option value="F">여자</option>
                </select>
                <br>
				<div class="bottom-container">
					<input type="submit" id="subBtn" class="bottom" value="가입 완료" disabled="disabled">
					<input type="reset" class="bottom" value="다시 쓰기">
				</div>
		</form>
	</main>
</body>
</html>
